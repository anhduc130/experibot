<html>

<head>
  <script src='https://statics.teams.cdn.office.net/sdk/v1.6.0/js/MicrosoftTeams.min.js'></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 15px;
    }
  </style>
</head>

<body>
  You will be redirected soon
  <span id="error"></span>
  <script>
    const toQueryString = (obj) => {
      return Object.keys(obj).map(prop => `${prop}=${encodeURIComponent(obj[prop])}`).join("&")
    }

    microsoftTeams.initialize(() => {
      microsoftTeams.getContext(function (context) {
        try {

          // Generate random state string and store it, so we can verify it in the callback
          let state = `${Math.random()}`; // _guid() is a helper function in the sample
          localStorage.setItem("simple.state", state);
          localStorage.removeItem("simple.error");
          // Go to the Azure AD authorization endpoint
          let queryParams = {
            client_id: "fa3e49b3-5bf1-46ea-bfc0-3e2fd370ed7f",
            response_type: "id_token token",
            response_mode: "fragment",
            scope: "https://graph.microsoft.com/User.Read openid profile email",
            redirect_uri: window.location.origin + "/auth/authSuccess.html",
            nonce: `${Math.random()}`,
            state: state,
            // The context object is populated by Teams; the loginHint attribute
            // is used as hinting information
            login_hint: context.loginHint,
          };

          let authorizeEndpoint = "https://login.microsoftonline.com/" + context.tid + "/oauth2/v2.0/authorize?" + toQueryString(queryParams);
          window.location.assign(authorizeEndpoint);
        } catch (err) {
          document.getElementById("error").innerHTML = err.message
        }
      })
    })

  </script>
</body>

</html>